<!DOCTYPE html>
<html>
<head>
    <title>Signup Page</title>
</head>
<body>
    <h2>Signup Form</h2>
    <form id="signupForm">
        <label for="first_name">First Name:</label><br>
        <input type="text" id="first_name" name="first_name"><br><br>
        <label for="last_initial">Last Name Initial:</label><br>
        <input type="text" id="last_initial" name="last_initial"><br><br>
        <label for="dob">Date of Birth:</label><br>
        <input type="date" id="dob" name="dob"><br><br>
        <label for="email">Email:</label><br>
        <input type="email" id="email" name="email"><br><br>
        <label for="password">Password:</label><br>
        <input type="password" id="password" name="password"><br><br>
        <input type="submit" value="Sign Up">
    </form>

    <h2>Login</h2>
    <form id="loginForm">
        <label for="login_email">Email:</label><br>
        <input type="email" id="login_email" name="email"><br><br>
        <label for="login_password">Password:</label><br>
        <input type="password" id="login_password" name="password"><br><br>
        <input type="submit" value="Login">
    </form>

    <h2>Reset Password</h2>
    <form id="resetPasswordForm">
        <label for="reset_email">Email:</label><br>
        <input type="email" id="reset_email" name="reset_email"><br><br>
        <input type="submit" value="Reset Password">
    </form>

    <script>
        document.getElementById('signupForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const firstName = document.getElementById('first_name').value;
            const lastInitial = document.getElementById('last_initial').value;
            const dob = document.getElementById('dob').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            const user = {
                firstName: firstName,
                lastInitial: lastInitial,
                dob: dob,
                email: email,
                password: password,
                derpCoins: 0,
                role: email === 'hamptonlogan562@gmail.com' ? 'Godly Derp' : 'New Derp'
            };

            localStorage.setItem(email, JSON.stringify(user));
            localStorage.setItem('currentUser', email);
            alert('Signup Successful');
            window.location.href = 'chat.html';
        });

        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const email = document.getElementById('login_email').value;
            const password = document.getElementById('login_password').value;
            const user = JSON.parse(localStorage.getItem(email));

            if (user && user.password === password) {
                localStorage.setItem('currentUser', email);
                alert(`Welcome, ${user.firstName} (${user.role})`);
                if (user.role === 'Godly Derp') {
                    window.location.href = 'search.html';
                } else {
                    window.location.href = 'chat.html';
                }
            } else {
                alert('Login Failed: Incorrect email or password.');
            }
        });

        document.getElementById('resetPasswordForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const email = document.getElementById('reset_email').value;
            const user = JSON.parse(localStorage.getItem(email));

            if (user) {
                const resetLink = `reset_password.html?email=${encodeURIComponent(email)}`;
                alert(`To decode a token, put in the content before the @ and use %40 before gmail.com, but after the content before the @.`);
                // Display the reset link to the user
                const resetLinkElement = document.createElement('p');
                resetLinkElement.innerHTML = `Click <a href="${resetLink}">here</a> to reset your password.`;
                document.body.appendChild(resetLinkElement);
            } else {
                alert('User not found.');
            }
        });
    </script>
</body>
</html>
